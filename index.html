<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>7-card pastel rainbow stack + swipe + flip + auto</title>

<style>
  /* ---------- 基本页面 ---------- */
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 35px;
    background: #f0f0f0;
  }

  .container {
    position: relative;
    width: 320px;
    height: 180px;
    perspective: 1200px; /* 让 3D 翻转更有透视感 */
    touch-action: pan-y;
  }

  .box {
    position: absolute;
    inset: 0;
    border-radius: 14px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
    user-select: none;

    /* 同时支持平移、缩放、阴影、3D 旋转 */
    transition:
      transform 0.45s ease,
      opacity 0.45s ease,
      box-shadow 0.45s ease;
    transform-style: preserve-3d; /* 让子元素也在 3D 空间 */
    backface-visibility: hidden;  /* 翻转时隐藏背面 */
  }

  /* 马卡龙彩虹色：7 张 */
  .c1 { background: #FFD5D5; } 
  .c2 { background: #FFE3C1; } 
  .c3 { background: #FFF6B0; } 
  .c4 { background: #DFF6D8; } 
  .c5 { background: #D7F4F9; } 
  .c6 { background: #D9E6FF; } 
  .c7 { background: #EBD8FF; }

  /* ---------- 翻牌动画辅助类 ---------- */
  .flip-out {
    transform: rotateY(-90deg) translateZ(0);
    opacity: 0.4;
  }
  .flip-in {
    transform: rotateY(90deg) translateZ(0);
    opacity: 0.4;
  }

  iframe {
    width: 320px;
    height: 180px;
    margin-top: 20px;
    border-radius: 10px;
    border: 2px solid #333;
    background: #fff;
  }

  /* 说明文字或控制按钮可选 */
  .controls {
    margin-top: 12px;
    font-size: 14px;
  }
  .controls button {
    margin: 0 6px;
    padding: 4px 10px;
    font-size: 14px;
  }

</style>
</head>

<body>

<div class="container" id="stack">
  <div class="box c1" data-title="Card 1">Card 1</div>
  <div class="box c2" data-title="Card 2">Card 2</div>
  <div class="box c3" data-title="Card 3">Card 3</div>
  <div class="box c4" data-title="Card 4">Card 4</div>
  <div class="box c5" data-title="Card 5">Card 5</div>
  <div class="box c6" data-title="Card 6">Card 6</div>
  <div class="box c7" data-title="Card 7">Card 7</div>
</div>

<iframe id="frame"></iframe>

<div class="controls">
  <button id="prevBtn">Prev</button>
  <button id="nextBtn">Next</button>
  <button id="toggleAuto">Auto ON</button>
</div>

<script>
  /* ---------- 配置 ---------- */
  const AUTO_INTERVAL_MS = 5000; // 自动轮播间隔
  const SWIPE_THRESHOLD = 40;    // 滑动阈值 px
  const SWIPE_VELOCITY_THRESHOLD = 0.3; // 速度阈值 px/ms，适当感知快速滑动

  const boxes = Array.from(document.querySelectorAll('.box'));
  const iframe = document.getElementById('frame');
  const stack = document.getElementById('stack');

  let current = 0;
  let isAuto = true;
  let autoTimer = null;

  /* ---------- 卡片内容示例 ---------- */
  const contents = boxes.map((b, idx) => {
    return `<h1>${b.dataset.title}</h1>`;
  });

  /* ---------- 渲染 stack ---------- */
  function render() {
    boxes.forEach((box, i) => {
      const offset = (i - current + boxes.length) % boxes.length;

      if (offset === 0) {
        // 顶层卡
        box.style.transform = 'translate(0,0) scale(1) rotateY(0deg)';
        box.style.opacity = '1';
        box.style.zIndex = 100;
        box.style.boxShadow = '0 18px 40px rgba(0,0,0,0.25)';
      } else {
        // 其它卡按顺序叠起
        const tx = offset * 16;    // 水平偏移量
        const ty = -offset * 10;   // 竖直偏移量（往上）
        const scale = 1 - offset * 0.04;
        box.style.transform =
          `translate(${tx}px, ${ty}px) scale(${scale}) rotateY(0deg)`;
        box.style.opacity = '0.9';
        box.style.zIndex = 100 - offset;
        box.style.boxShadow = '0 8px 20px rgba(0,0,0,0.14)';
      }
    });

    iframe.srcdoc = contents[current];
  }

  /* ---------- 切换逻辑 ---------- */
  function next() {
    // flip out current
    const curBox = boxes[current];
    curBox.classList.add('flip-out');
    setTimeout(() => {
      curBox.classList.remove('flip-out');
      performIndexChange(1);
    }, 230); // 约半程动画时间
  }

  function prev() {
    // flip out current (反方向效果也可同样使用)
    const curBox = boxes[current];
    curBox.classList.add('flip-out');
    setTimeout(() => {
      curBox.classList.remove('flip-out');
      performIndexChange(-1);
    }, 230);
  }

  function performIndexChange(delta) {
    current = (current + delta + boxes.length) % boxes.length;

    // flip in new top card for微动画
    const newTop = boxes[current];
    newTop.classList.add('flip-in');
    render(); // 先布局新 stack 状态
    setTimeout(() => {
      newTop.classList.remove('flip-in');
      render(); // 再刷新让动画归位
    }, 230);

    resetAuto();
  }

  /* ---------- 点击 ---------- */
  boxes.forEach(b => {
    b.addEventListener('click', next);
  });

  /* ---------- 左右按钮 ---------- */
  document.getElementById('nextBtn').addEventListener('click', next);
  document.getElementById('prevBtn').addEventListener('click', prev);

  /* ---------- 自动轮播 ---------- */
  function startAuto() {
    if (autoTimer) clearInterval(autoTimer);
    autoTimer = setInterval(next, AUTO_INTERVAL_MS);
    isAuto = true;
    document.getElementById('toggleAuto').textContent = 'Auto ON';
  }
  function stopAuto() {
    if (autoTimer) clearInterval(autoTimer);
    autoTimer = null;
    isAuto = false;
    document.getElementById('toggleAuto').textContent = 'Auto OFF';
  }
  function resetAuto() {
    if (isAuto) startAuto();
  }
  document.getElementById('toggleAuto').addEventListener('click', () => {
    if (isAuto) stopAuto();
    else startAuto();
  });

  /* ---------- 惯性拖拽 / swipe ---------- */
  let startX = 0;
  let startTime = 0;
  let isPointerDown = false;

  stack.addEventListener('pointerdown', e => {
    isPointerDown = true;
    startX = e.clientX;
    startTime = Date.now();
    stack.setPointerCapture(e.pointerId);
  });

  stack.addEventListener('pointermove', e => {
    // 可用于未来做拖拽式实时跟随
  });

  stack.addEventListener('pointerup', e => {
    if (!isPointerDown) return;
    isPointerDown = false;
    stack.releasePointerCapture(e.pointerId);

    const dx = e.clientX - startX;
    const dt = Date.now() - startTime;
    const velocity = dx / dt; // px per ms

    // 既判断位移也判断速度，满足其中即触发
    if (dx < -SWIPE_THRESHOLD || velocity < -SWIPE_VELOCITY_THRESHOLD) {
      next();
    } else if (dx > SWIPE_THRESHOLD || velocity > SWIPE_VELOCITY_THRESHOLD) {
      prev();
    } else {
      // 不够阈值，不切换
    }
  });

  stack.addEventListener('pointercancel', e => {
    isPointerDown = false;
  });

  /* ---------- 初始渲染 ---------- */
  render();
  startAuto();
</script>

</body>
</html>
